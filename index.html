<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£</title>

<style>
*{box-sizing:border-box}
body{margin:0;font-family:sans-serif;background:#f2f4f8}
.container{
  max-width:420px;margin:40px auto;background:#fff;
  padding:16px;border-radius:12px;
  box-shadow:0 4px 16px rgba(0,0,0,.15)
}
h2,h3{text-align:center}
button{
  width:100%;padding:12px;margin:6px 0;
  border:none;border-radius:8px;
  background:#2b7cff;color:#fff;font-size:16px
}
input,select{
  width:100%;padding:10px;margin:6px 0;
  border-radius:6px;border:1px solid #ccc
}
.hidden{display:none}
.menu{
  border:1px solid #ddd;border-radius:8px;
  padding:6px;text-align:center
}
.menu img{
  width:100%;height:90px;object-fit:cover;border-radius:6px
}
.grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
.badge{background:#eee;padding:6px;border-radius:6px;margin:4px 0}
</style>
</head>

<body>

<div class="container" id="home">
  <h2>üçΩÔ∏è ‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h2>
  <button onclick="show('login')">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
  <button onclick="show('register')">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
</div>

<div class="container hidden" id="register">
  <h3>‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h3>
  <select id="rRole">
    <option value="student">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>
    <option value="seller">‡∏Ñ‡∏ô‡∏Ç‡∏≤‡∏¢</option>
  </select>
  <input id="rUser" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ‚â• 10 ‡∏ï‡∏±‡∏ß">
  <input id="rPass" type="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô ‚â• 10 ‡∏ï‡∏±‡∏ß">
  <button onclick="register()">‡∏™‡∏°‡∏±‡∏Ñ‡∏£</button>
  <button onclick="show('home')">‡∏Å‡∏•‡∏±‡∏ö</button>
</div>

<div class="container hidden" id="login">
  <h3>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h3>
  <select id="lRole">
    <option value="student">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>
    <option value="seller">‡∏Ñ‡∏ô‡∏Ç‡∏≤‡∏¢</option>
  </select>
  <input id="lUser" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ">
  <input id="lPass" type="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
  <button onclick="login()">‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</button>
  <button onclick="show('home')">‡∏Å‡∏•‡∏±‡∏ö</button>
</div>

<div class="container hidden" id="shop">
  <h3 id="shopTitle">‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h3>
  <div id="timeInfo"></div>

  <div id="noMenu" style="text-align:center;color:#777">
    ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏´‡∏≤‡∏£
  </div>

  <div id="menuList" class="grid"></div>

  <!-- ‡∏Ñ‡∏ô‡∏Ç‡∏≤‡∏¢ -->
  <div id="sellerPanel" class="hidden">
    <hr>
    <h3>Dashboard ‡∏Ñ‡∏ô‡∏Ç‡∏≤‡∏¢</h3>
    <div class="badge" id="dashMenu"></div>
    <div class="badge" id="dashOrder"></div>
    <div class="badge" id="dashTotal"></div>

    <input id="shopName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô">
    <label>‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡πâ‡∏≤‡∏ô</label>
    <input type="time" id="openTime" value="11:30">
    <label>‡∏õ‡∏¥‡∏î‡∏£‡πâ‡∏≤‡∏ô</label>
    <input type="time" id="closeTime" value="13:00">

    <hr>
    <input type="file" id="foodImg" accept="image/*">
    <input id="foodName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏≤‡∏´‡∏≤‡∏£">
    <input id="foodPrice" type="number" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤">
    <button onclick="addMenu()">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π</button>
  </div>

  <button onclick="logout()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
</div>

<script>
/* ================== CONFIG ================== */
// üëâ ‡πÉ‡∏™‡πà URL Google Apps Script ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
const SHEET_API = "https://script.google.com/macros/s/XXXXXXXX/exec";

/* ================== DATA ================== */
let users=[], current=null;
let menus=[], orders=[];
let shop={name:"",open:"11:30",close:"13:00"};

/* ================== UI ================== */
function show(id){
  document.querySelectorAll(".container").forEach(c=>c.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
}

/* ================== AUTH ================== */
function register(){
  if(rUser.value.length<10||rPass.value.length<10)
    return alert("‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 10 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£");
  users.push({u:rUser.value,p:rPass.value,r:rRole.value});
  alert("‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à"); show("login");
}

function login(){
  const f=users.find(x=>x.u===lUser.value&&x.p===lPass.value&&x.r===lRole.value);
  if(!f){alert("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");show("home");return}
  current=f; show("shop");
  sellerPanel.classList.toggle("hidden",current.r!=="seller");
  render();
}

function logout(){current=null;show("home")}

/* ================== MENU ================== */
function addMenu(){
  if(!foodImg.files[0]||!foodName.value||!foodPrice.value)
    return alert("‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö");
  const r=new FileReader();
  r.onload=e=>{
    menus.push({img:e.target.result,name:foodName.value,price:+foodPrice.value});
    render();
  };
  r.readAsDataURL(foodImg.files[0]);
}

/* ================== ORDER ================== */
function order(m){
  if(!isOpen()) return alert("‡∏£‡πâ‡∏≤‡∏ô‡∏õ‡∏¥‡∏î");
  orders.push(m);
  sendSheet(m);
  alert("‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
  render();
}

/* ================== TIME ================== */
function isOpen(){
  const now=new Date().toTimeString().slice(0,5);
  return now>=shop.open && now<=shop.close;
}

/* ================== RENDER ================== */
function render(){
  shop.name=shopName.value||shop.name;
  shop.open=openTime.value; shop.close=closeTime.value;
  shopTitle.textContent=shop.name||"‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£";

  timeInfo.textContent=`üïí ${shop.open} - ${shop.close}`;

  menuList.innerHTML="";
  noMenu.style.display=menus.length?"none":"block";

  menus.forEach(m=>{
    const d=document.createElement("div");
    d.className="menu";
    d.innerHTML=`<img src="${m.img}">
      <div>${m.name}</div><b>${m.price} ‡∏ö‡∏≤‡∏ó</b>`;
    if(current.r==="student"){
      const b=document.createElement("button");
      b.textContent="‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£";
      b.onclick=()=>order(m);
      d.appendChild(b);
    }
    menuList.appendChild(d);
  });

  if(current.r==="seller"){
    dashMenu.textContent="‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: "+menus.length;
    dashOrder.textContent="‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå: "+orders.length;
    dashTotal.textContent="‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢: "+
      orders.reduce((s,o)=>s+o.price,0)+" ‡∏ö‡∏≤‡∏ó";
  }
}

/* ================== SHEETS ================== */
function sendSheet(m){
  fetch(SHEET_API,{
    method:"POST",
    body:JSON.stringify({
      shop:shop.name,menu:m.name,price:m.price,
      time:new Date().toLocaleString("th-TH")
    })
  });
}

/* ================== PWA ================== */
if("serviceWorker"in navigator){
  const sw=`
    self.addEventListener("fetch",e=>{
      e.respondWith(fetch(e.request).catch(()=>new Response("offline")));
    });
  `;
  const blob=new Blob([sw],{type:"text/javascript"});
  navigator.serviceWorker.register(URL.createObjectURL(blob));
}
</script>

</body>
</html>
