<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>สั่งอาหาร</title>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Arial,sans-serif;
  background:#f2f2f2;
}
.container{
  max-width:420px;
  width:92%;
  margin:40px auto;
  background:#fff;
  padding:16px;
  border-radius:12px;
  box-shadow:0 4px 16px rgba(0,0,0,.2);
}
h2,h3,h4{text-align:center;margin:10px 0}
button{
  width:100%;
  padding:12px;
  margin:8px 0;
  border:none;
  border-radius:8px;
  background:#2b7cff;
  color:#fff;
  font-size:16px;
  cursor:pointer;
}
input,select{
  width:100%;
  padding:10px;
  margin:6px 0;
  border-radius:6px;
  border:1px solid #ccc;
}
.hidden{display:none}
#menuList{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:10px;
}
.menu{
  border:1px solid #ddd;
  border-radius:8px;
  padding:6px;
  text-align:center;
}
.menu img{
  width:100%;
  height:90px;
  object-fit:cover;
  border-radius:6px;
}
.price{font-weight:bold}
</style>
</head>

<body>

<!-- หน้าแรก -->
<div class="container" id="home">
  <h2>สั่งอาหาร</h2>
  <button onclick="showPage('login')">เข้าสู่ระบบ</button>
  <button onclick="showPage('register')">สมัครสมาชิก</button>
</div>

<!-- สมัคร -->
<div class="container hidden" id="register">
  <h3>สมัครสมาชิก</h3>
  <select id="regRole">
    <option value="student">นักเรียน</option>
    <option value="seller">คนขาย</option>
  </select>
  <input id="regUser" placeholder="ชื่อผู้ใช้ (อย่างน้อย 10 ตัว)">
  <input id="regPass" type="password" placeholder="รหัสผ่าน (อย่างน้อย 10 ตัว)">
  <button onclick="register()">สมัคร</button>
  <button onclick="showPage('home')">กลับ</button>
</div>

<!-- เข้าสู่ระบบ -->
<div class="container hidden" id="login">
  <h3>เข้าสู่ระบบ</h3>
  <select id="loginRole">
    <option value="student">นักเรียน</option>
    <option value="seller">คนขาย</option>
  </select>
  <input id="loginUser" placeholder="ชื่อผู้ใช้">
  <input id="loginPass" type="password" placeholder="รหัสผ่าน">
  <button onclick="login()">เข้าสู่ระบบ</button>
  <button onclick="showPage('home')">กลับ</button>
</div>

<!-- ร้านอาหาร -->
<div class="container hidden" id="shop">
  <h3 id="shopTitle">ร้านอาหาร</h3>
  <p id="studentMsg" style="text-align:center;color:#666">ยังไม่มีเมนูอาหาร</p>

  <div id="menuList"></div>

  <!-- คนขาย -->
  <div id="sellerPanel" class="hidden">
    <hr>
    <h4>สำหรับคนขาย</h4>
    <input id="shopName" placeholder="ชื่อร้านอาหาร">
    <button onclick="createShop()">สร้างร้าน</button>
    <hr>
    <input type="file" id="foodImg" accept="image/*">
    <input id="foodName" placeholder="ชื่ออาหาร">
    <input id="foodPrice" type="number" placeholder="ราคา (บาท)">
    <button onclick="addMenu()">เพิ่มเมนู</button>
  </div>

  <button onclick="logout()">ออกจากระบบ</button>
</div>

<script>
let currentRole = "";
let menus = JSON.parse(localStorage.getItem("menus") || "[]");

/* เปลี่ยนหน้า */
function showPage(id){
  document.querySelectorAll('.container')
    .forEach(d => d.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
}

/* ตรวจสอบข้อมูล */
function validate(user, pass){
  if(!user || !pass){
    alert("❌ ต้องกรอกชื่อผู้ใช้และรหัสผ่าน");
    return false;
  }
  if(user.length < 10 || pass.length < 10){
    alert("❌ ต้องมีอย่างน้อย 10 ตัวอักษร");
    return false;
  }
  return true;
}

/* สมัคร */
function register(){
  const user = regUser.value.trim();
  const pass = regPass.value.trim();
  const role = regRole.value;

  if(!validate(user, pass)) return;

  localStorage.setItem("account", JSON.stringify({user, pass, role}));
  alert("✅ สมัครสำเร็จ");
  showPage("login");
}

/* เข้าสู่ระบบ */
function login(){
  const user = loginUser.value.trim();
  const pass = loginPass.value.trim();
  const role = loginRole.value;

  if(!validate(user, pass)) return;

  const acc = JSON.parse(localStorage.getItem("account"));
  if(!acc || user !== acc.user || pass !== acc.pass || role !== acc.role){
    alert("❌ ชื่อผู้ใช้หรือรหัสผ่านไม่ถูกต้อง");
    showPage("home");
    return;
  }

  currentRole = role;
  showPage("shop");
  renderMenu();

  if(role === "seller"){
    sellerPanel.classList.remove("hidden");
    studentMsg.style.display = "none";
  }
}

/* ออกจากระบบ */
function logout(){
  showPage("home");
}

/* สร้างร้าน */
function createShop(){
  if(!shopName.value.trim()) return alert("กรุณากรอกชื่อร้าน");
  shopTitle.textContent = shopName.value;
}

/* เพิ่มเมนู */
function addMenu(){
  if(!foodImg.files[0] || !foodName.value || !foodPrice.value)
    return alert("กรอกข้อมูลเมนูให้ครบ");

  const reader = new FileReader();
  reader.onload = e => {
    menus.push({
      img: e.target.result,
      name: foodName.value,
      price: foodPrice.value
    });
    localStorage.setItem("menus", JSON.stringify(menus));
    renderMenu();
  };
  reader.readAsDataURL(foodImg.files[0]);
}

/* แสดงเมนู */
function renderMenu(){
  menuList.innerHTML = "";
  if(menus.length === 0){
    studentMsg.style.display = "block";
    return;
  }
  studentMsg.style.display = "none";
  menus.forEach(m => {
    const d = document.createElement("div");
    d.className = "menu";
    d.innerHTML = `
      <img src="${m.img}">
      <div>${m.name}</div>
      <div class="price">${m.price} บาท</div>
    `;
    menuList.appendChild(d);
  });
}
</script>

</body>
</html>
